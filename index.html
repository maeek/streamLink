<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="theme-color" content="#0E1F34">
    <title>Stream linki</title>
    <style>
        body {
            background: #0E1F34;
        }
        
        div.con {
            width: 50%;
            height: 100vh;
            background-color: #0E1F34;
            text-align: center;
            color: #FFF;
            transition: background-color 1000ms, color 300ms;
            overflow: hidden;
        }
        
        a {
            color: #FFF;
            transition: color 300ms;
            -webkit-text-decoration-color: #27B9A2;
            text-decoration-color: #27B9A2;
        }
        
        div.con:hover {
            background-color: #395175;
            color: #FFF !important;
        }
        
        div.con:hover a {
            color: #FFF !important;
        }
        
        div.con div.btn {
            width: auto;
            height: auto;
            margin-top: 37vh;
            font-weight: 100;
            font-size: 60px;
            font-family: Arial;
        }
        
        div.setup div.btn {
            margin-top: 37vh;
        }
        
        .setup {
            transition: width .45s;
        }
        
        input {
            width: 90%;
            font-family: Roboto;
            background: transparent;
            border: none;
            border-bottom: 1px solid #27B9A2;
            color: #FFF;
            outline: none;
            text-align: center;
            font-size: 35px;
            height: 40px;
        }
        
        button {
            border: 0;
            background: transparent;
            color: #FFF;
            border-bottom: 2px solid #27B9A2;
            font-size: 35px;
            outline: none;
            height: 45px;
        }
    </style>
</head>

<body style="margin:0;padding: 0;">
    <div class="con redirect" style="float:left;cursor: pointer;">
        <div class="btn"><a data-redirect href="" class="redirect_link">Redirect</a></div>
    </div>
    <div class="con setup" style="float:right;">
        <div class="btn">Setup</div>
        <input type="text" name="link" class="input">
        <button data-type="submit" class="save">Zapisz</button>
        <div style="width:100%;padding-top: 15px;font-size: 33px;font-family: Arial;">Załadowany link<br>
            <a data-saved href="" class="saved"></a>
        </div>
    </div>
    <script>
        function atEvt(obj, name, handler) {
            if (obj.addEventListener) {
                obj.addEventListener(name, handler, false);
            } else {
                obj.attachEvent('on' + name, handler);
            }

        }

        var save = document.getElementsByClassName("save")[0];
        var redirect = document.getElementsByClassName("redirect_link")[0];
        var savedLink = document.getElementsByClassName("saved")[0];
        var input = document.getElementsByClassName("input")[0];
        var setup = document.getElementsByClassName("setup")[0];

        function redirectClick() {
            location.href = redirect.href;
        }

        function saveClick() {
            if (input.value) {
                save.innerText = 'Ładowanie...';
                var req = new XMLHttpRequest();
                req.open('POST', '/');
                req.setRequestHeader('Content-Type', 'application/json');
                req.onreadystatechange = function() {
                    if (req.readyState == 4) {
                        if (req.status == 200) {
                            var res = JSON.parse(req.responseText);
                            redirect.href = res.plink;
                            savedLink.href = res.link;
                            savedLink.innerText = res.link;
                            save.innerText = 'Gotowe!';
                            setTimeout(function() {
                                save.innerText = 'Zapisz';
                            }, 3000)
                        } else {
                            save.innerText = 'Nie udało sie uzyskać linku';
                            setTimeout(function() {
                                save.innerText = 'Zapisz';
                            }, 3000);
                        }
                    }
                };
                req.send(JSON.stringify({
                    action: 'new',
                    link: input.value
                }));
            }
        }

        function init() {

            var req = new XMLHttpRequest();
            req.open('POST', '/');
            req.setRequestHeader('Content-Type', 'application/json');
            req.onreadystatechange = function() {
                if (req.readyState == 4) {
                    if (req.status == 200) {
                        var res = JSON.parse(req.responseText);
                        redirect.href = res.plink;
                        savedLink.href = res.link;
                        savedLink.innerText = res.link;
                    } else {
                        console.log('ERROR');
                    }
                }
            };
            req.send(JSON.stringify({
                action: 'get'
            }));


            atEvt(document.getElementsByClassName('redirect')[0], 'click', redirectClick);
            atEvt(save, 'click', saveClick);
        }
        atEvt(document, 'DOMContentLoaded', init);
    </script>
</body>

</html>
