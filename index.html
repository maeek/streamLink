<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="theme-color" content="#0E1F34">
    <title>Stream linki</title>
    <style>
        div.con {
            width: 50%;
            height: 100vh;
            background-color: #0E1F34;
            text-align: center;
            color: #FFF;
            transition: background-color 1000ms, color 300ms;
            overflow: hidden;
        }
        
        a {
            color: #FFF;
            transition: color 300ms;
            text-decoration-color: #27B9A2;
        }
        
        div.con:hover {
            background-color: #395175;
            color: #FFF !important;
        }
        
        div.con:hover a {
            color: #FFF !important;
        }
        
        div.con div.btn {
            width: auto;
            height: auto;
            margin-top: 37vh;
            font-weight: 100;
            font-size: 60px;
            font-family: Arial;
        }
        
        div.setup div.btn {
            margin-top: 37vh;
        }
        
        .setup {
            transition: width .45s;
        }
        
        input {
            width: 90%;
            font-family: Roboto;
            background: transparent;
            border: none;
            border-bottom: 1px solid #27B9A2;
            color: #FFF;
            outline: none;
            text-align: center;
            font-size: 35px;
            height: 40px;
        }
        
        button {
            border: none;
            background: transparent;
            color: #FFF;
            border-bottom: 2px solid #27B9A2;
            font-size: 35px;
            outline: none;
            height: 45px;
        }
    </style>
</head>

<body style="margin:0;padding: 0;">
    <div class="con redirect" style="float:left;cursor: pointer;">
        <div class="btn"><a data-redirect href="">Redirect</a></div>
    </div>
    <div class="con setup" style="float:right;">
        <div class="btn">Setup</div>
        <input type="text" name="link">
        <button data-type="submit">Zapisz</button>
        <div style="width:100%;padding-top: 15px;font-size: 33px;font-family: Arial;">Załadowany link<br>
            <a data-saved href=""></a>
        </div>
    </div>

    <script defer>
        const save = document.querySelector('button');
        const redirect = document.querySelector('a[data-redirect]');
        const savedLink = document.querySelector('a[data-saved]');
        const input = document.querySelector('input[name="link"]');
        const setup = document.querySelector('.setup');
        fetch('/', {
                method: 'POST',
                cache: 'no-cache',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    action: 'get'
                })
            })
            .then(res => res.json())
            .then(res => {
                redirect.href = res.plink;
                savedLink.href = res.link;
                savedLink.innerText = res.link;
            });
        document.querySelector('.redirect').onclick = function() {
            location.href = redirect.href;
        }
        save.onclick = function() {
            if (input.value) {
                save.innerText = 'Ładowanie...';
                fetch('/', {
                        method: 'POST',
                        cache: 'no-cache',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            action: 'new',
                            link: input.value
                        })
                    })
                    .then(res => res.json())
                    .then(res => {
                        redirect.href = res.links[0].link;
                        savedLink.href = res.link;
                        savedLink.innerText = res.link;
                        save.innerText = 'Gotowe!';
                        setTimeout(() => {
                            save.innerText = 'Zapisz';
                        }, 3000)
                    }).catch(e => {
                        save.innerText = 'Nie udało sie uzyskać linku';
                        setTimeout(() => {
                            save.innerText = 'Zapisz';
                        }, 3000);
                    });
            }
        }
    </script>

</body>

</html>
